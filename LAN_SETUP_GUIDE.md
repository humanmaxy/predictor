# 局域网聊天服务器配置指南

## 🌐 局域网部署配置

### 服务器端配置 (172.27.66.166)

1. **启动服务器启动器**：
   ```cmd
   # Windows
   start_server.bat
   
   # 或手动启动
   python start_server.py
   ```

2. **服务器配置**：
   - **主机地址**: `0.0.0.0` (监听所有网络接口)
   - **端口**: `8765` (或其他可用端口)
   - **协议**: HTTP (局域网通常不需要HTTPS)

3. **点击"启动服务器"**

### 客户端配置 (其他机器)

1. **启动客户端**：
   ```cmd
   # Windows
   python chat_client.py
   ```

2. **服务器配置**：
   - **服务器地址**: `172.27.66.166` (服务器的局域网IP)
   - **端口**: `8765` (与服务器相同)
   - **协议**: HTTP

3. **用户信息**：
   - **用户名**: 输入您的昵称
   - **用户ID**: 自动生成或自定义

4. **点击"连接"**

## 🔧 快速配置

### 服务器端
- 点击"局域网"按钮自动设置主机地址为 `0.0.0.0`
- 或手动输入 `0.0.0.0` 以监听所有网络接口

### 客户端
- 点击"局域网"按钮自动设置服务器地址为 `172.27.66.166`
- 或点击"自定义"按钮打开配置对话框

## 🛠️ 故障排除

### 常见问题

1. **连接被拒绝**：
   - 检查服务器是否正在运行
   - 确认端口号匹配
   - 检查防火墙设置

2. **无法连接到局域网服务器**：
   - 确认服务器使用 `0.0.0.0` 作为主机地址
   - 检查网络连通性：`ping 172.27.66.166`
   - 确认防火墙允许端口 8765

3. **防火墙配置**：
   
   **Windows 服务器端**：
   ```cmd
   # 允许入站连接到端口8765
   netsh advfirewall firewall add rule name="Chat Server" dir=in action=allow protocol=TCP localport=8765
   ```
   
   **或通过Windows防火墙界面**：
   - 控制面板 → 系统和安全 → Windows Defender 防火墙
   - 高级设置 → 入站规则 → 新建规则
   - 端口 → TCP → 特定本地端口 → 8765 → 允许连接

### 网络测试

1. **测试网络连通性**：
   ```cmd
   # 在客户端机器上测试
   ping 172.27.66.166
   telnet 172.27.66.166 8765
   ```

2. **检查端口占用**：
   ```cmd
   # 在服务器上检查端口是否被占用
   netstat -an | findstr :8765
   ```

## 📋 配置检查清单

### 服务器端 (172.27.66.166)
- [ ] Python 和 websockets 包已安装
- [ ] 服务器启动器已运行
- [ ] 主机地址设置为 `0.0.0.0`
- [ ] 端口设置为 `8765`
- [ ] 服务器状态显示"服务器运行中"
- [ ] 防火墙允许端口 8765 入站连接

### 客户端端
- [ ] Python 和 websockets 包已安装
- [ ] 客户端已启动
- [ ] 服务器地址设置为 `172.27.66.166`
- [ ] 端口设置为 `8765`
- [ ] 用户名和用户ID已填写
- [ ] 网络能ping通服务器

## 🎯 快速测试步骤

1. **服务器端**：
   - 运行 `start_server.bat`
   - 点击"局域网"按钮
   - 点击"启动服务器"
   - 确认看到"server listening on 0.0.0.0:8765"

2. **客户端**：
   - 运行 `python chat_client.py`
   - 点击"局域网"按钮
   - 输入用户名
   - 点击"连接"

如果仍有问题，请查看启动器和客户端的日志信息获取详细错误。