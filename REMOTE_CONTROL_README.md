# 网络共享聊天 - 远程控制功能

## 功能概述

基于现有的网络共享聊天模块，新增了以下远程控制功能：

### 1. 文件下载功能增强
- ✅ **指定下载目录**：支持右键点击下载链接，选择"另存为..."来指定保存位置
- ✅ **默认下载**：左键点击直接下载到默认目录
- ✅ **自动重命名**：如果文件已存在，自动添加序号避免覆盖

### 2. 屏幕共享功能
- ✅ **实时屏幕捕获**：自动捕获本地屏幕内容
- ✅ **屏幕显示**：实时显示远程用户的屏幕
- ✅ **可调参数**：支持调整帧率、图像质量和缩放比例
- ✅ **基于共享目录**：通过网络共享目录传输屏幕数据

### 3. 远程控制功能
- ✅ **鼠标控制**：支持鼠标移动、左键/右键点击、滚轮操作
- ✅ **键盘输入**：支持按键和文本输入
- ✅ **坐标转换**：自动处理不同屏幕分辨率的坐标转换
- ✅ **权限控制**：可选择是否允许他人控制自己的电脑

### 4. 用户界面
- ✅ **远程控制面板**：集成到主聊天窗口
- ✅ **屏幕共享窗口**：独立的屏幕显示和控制窗口
- ✅ **状态显示**：实时显示连接和控制状态
- ✅ **简单操作**：一键开启/关闭各项功能

## 技术实现原理

### 共享目录结构
```
网络共享目录/
├── public/              # 群聊消息
├── private/             # 私聊消息
├── users/               # 用户信息
├── files/               # 共享文件
├── images/              # 共享图片
└── remote_control/      # 远程控制数据
    ├── screens/         # 屏幕截图文件
    ├── controls/        # 控制命令文件
    └── config.json      # 配置信息
```

### 屏幕共享原理
1. **屏幕捕获**：使用PIL库的ImageGrab模块捕获屏幕
2. **图像压缩**：将截图压缩为JPEG格式，减少传输数据量
3. **文件存储**：将屏幕数据保存到共享目录的screens子目录
4. **实时更新**：定期更新屏幕文件，其他用户读取最新文件显示

### 远程控制原理
1. **命令生成**：将鼠标键盘操作转换为JSON格式的命令
2. **命令传输**：通过共享目录的controls子目录传输命令
3. **命令执行**：使用pyautogui库执行远程控制命令
4. **坐标转换**：根据屏幕分辨率自动转换坐标

### 文件下载增强
1. **右键菜单**：为下载链接添加右键上下文菜单
2. **文件对话框**：使用tkinter的文件保存对话框
3. **自定义路径**：支持用户选择任意保存位置
4. **文件类型过滤**：根据文件类型提供合适的过滤选项

## 安装和使用

### 1. 安装依赖
```bash
# 方法1：使用安装脚本（推荐）
python install_remote_control_deps.py

# 方法2：手动安装
pip install -r requirements.txt
```

### 2. 启动程序
```bash
# 启动主聊天客户端
python network_share_chat.py

# 启动功能演示
python demo_remote_control.py
```

### 3. 功能使用

#### 文件下载增强
1. 在聊天中收到文件时，会显示下载链接
2. **左键点击**：直接下载到默认目录
3. **右键点击**：显示菜单，选择"另存为..."指定保存位置

#### 屏幕共享
1. 连接到聊天室后，在远程控制面板中
2. 点击"📺 屏幕共享"按钮打开屏幕共享窗口
3. 点击"开始共享"开始共享自己的屏幕
4. 点击"开始查看"查看他人共享的屏幕

#### 远程控制
1. 勾选"允许他人控制我的电脑"允许被控制
2. 在屏幕共享窗口中，可以通过鼠标键盘控制远程屏幕
3. 支持鼠标点击、移动、滚轮和键盘输入

## 安全注意事项

⚠️ **重要安全提醒**：
1. 远程控制功能具有较高权限，请谨慎使用
2. 仅在信任的局域网环境中使用
3. 及时关闭不需要的控制权限
4. 定期检查共享目录的访问权限

## 系统要求

- **操作系统**：Windows、macOS、Linux
- **Python版本**：3.7+
- **网络环境**：局域网或可访问的网络共享目录
- **权限要求**：屏幕捕获和鼠标键盘控制权限

## 依赖包说明

- **pillow**：图像处理和屏幕截图
- **pyautogui**：鼠标键盘控制
- **tkinter**：图形用户界面（Python内置）

## 故障排除

### 常见问题

1. **无法捕获屏幕**
   - 检查是否安装了pillow包
   - 确认系统允许屏幕捕获权限

2. **远程控制不工作**
   - 检查是否安装了pyautogui包
   - 确认系统允许辅助功能权限（macOS）

3. **共享目录访问失败**
   - 检查网络连接和共享目录权限
   - 确认目录路径正确

4. **性能问题**
   - 调整屏幕捕获的帧率和质量参数
   - 检查网络带宽和共享目录性能

### 调试模式
```bash
# 启用详细日志输出
python network_share_chat.py --debug
```

## 更新日志

### v2.0 (当前版本)
- ✅ 新增文件下载功能增强
- ✅ 新增屏幕共享功能
- ✅ 新增远程控制功能
- ✅ 新增远程控制用户界面
- ✅ 集成到主聊天程序

### v1.0 (基础版本)
- ✅ 基础聊天功能
- ✅ 文件传输功能
- ✅ 网络共享目录支持

## 开发者信息

本功能基于网络共享聊天模块开发，通过共享目录实现远程控制，无需额外的网络配置，适合局域网环境使用。

如有问题或建议，请查看项目文档或联系开发者。